<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tacmagic">
<title>Analysis with tacmagic • tacmagic</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis with tacmagic">
<meta property="og:description" content="tacmagic">
<meta property="og:image" content="https://docs.ropensci.org/tacmagic/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">tacmagic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/walkthrough.html">Analysis with tacmagic</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/tacmagic/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Analysis with tacmagic</h1>
                        <h4 data-toc-skip class="author">Eric Brown</h4>
            
            <h4 data-toc-skip class="date">2024-02-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/tacmagic/blob/HEAD/vignettes/walkthrough.Rmd" class="external-link"><code>vignettes/walkthrough.Rmd</code></a></small>
      <div class="d-none name"><code>walkthrough.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/Positron_emission_tomography" class="external-link">Positron emission tomography</a> (PET) is a research and clinical imaging modality that uses radioactive tracers that bind to target molecules of interest. A PET scanner identifies the tracer location by virtue of the tracer’s radioactive decay, providing information to determine the location of the target in the body. As the spatial resolution of PET is relatively poor, analysis is frequently combined with higher resolution imaging such as magnetic resonance imaging (MRI), which can be spatially co-registered to the PET image. Subsequently, radiotracer activity (over time) can be identified by spatial region of interest (ROI).</p>
<p>An image analysis pipeline is required to extract regional time activity curves (TACs) from a dynamic PET image. There are various pipelines available including widely-used commercial solutions (e.g. <a href="https://www.pmod.com/web/" class="external-link">PMOD</a>) and newer open-source options (e.g. magia<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Tomi Karjalainen, Severi Santavirta, Tatu Kantonen, Jouni Tuisku, Lauri Tuominen, Jussi Hirvonen, Jarmo Hietala, Juha Rinne, Lauri Nummenmaa. Magia: Robust automated modeling and image processing toolbox for PET neuroinformatics. bioRxiv 604835; &lt;a href="https://doi.org/10.1101/604835" class="external-link uri"&gt;https://doi.org/10.1101/604835&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>). Pipelines generally implement the following steps:</p>
<ul>
<li>Dynamic PET pre-processing (e.g. motion correction, decay-correction)</li>
<li>PET image co-registration with structural MRI</li>
<li>MRI segmentation and normalization to atlas</li>
</ul>
<p>Various pipelines save TAC, volume and related data in various formats. This package enables the loading and analysis of TAC and ROI volume data from image analysis pipelines for further analysis in R.</p>
</div>
<div class="section level2">
<h2 id="vignette-data">Vignette data<a class="anchor" aria-label="anchor" href="#vignette-data"></a>
</h2>
<p>The sample data for this vignette uses an anonymized scans of a participant with Alzheimer’s dementia, data from <a href="http://www.gaain.org" class="external-link uri">http://www.gaain.org</a> which was generously made available for unrestricted use.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Klunk, William E., Robert A. Koeppe, Julie C. Price, Tammie L. Benzinger, Michael D. Devous, William J. Jagust, Keith A. Johnson, et al. “The Centiloid Project: Standardizing Quantitative Amyloid Plaque Estimation by PET.” Alzheimer’s &amp;amp; Dementia 11, no. 1 (January 2015): 1-15.e4. &lt;a href="https://doi.org/10.1016/j.jalz.2014.07.003" class="external-link uri"&gt;https://doi.org/10.1016/j.jalz.2014.07.003&lt;/a&gt;.&lt;/p&gt;'><sup>2</sup></a> The radiotracer used is Pittsburgh Compound B (PIB) which binds to beta-amyloid, a protein found in high concentration in the brains of individuals with Alzheimer’s dementia.</p>
<p>There are two approaches to using the <strong>tacmagic</strong> package to analyze PET time-activity curve data: either by loading participant data individually and using the various functions to analyze it, or via the batch functions to list and analyze data from multiple participants. Here, we illustrate the main features of tacmagic, by walking through the analysis of a single participant. We provide an explanation of the batch mode at the end.</p>
</div>
<div class="section level2">
<h2 id="time-activity-curve-operations">Time-activity curve operations<a class="anchor" aria-label="anchor" href="#time-activity-curve-operations"></a>
</h2>
<div class="section level3">
<h3 id="data-loading">Data loading<a class="anchor" aria-label="anchor" href="#data-loading"></a>
</h3>
<p>Time-activity curve (TAC) data is loaded via <code><a href="../reference/load_tac.html">load_tac()</a></code>, which is a wrapper for format-specific functions. To specify which file format the TAC data is stored as, use the <code>format</code> parameter. Supported formats can be viewed in <code><a href="../reference/load_tac.html">help(load_tac)</a></code>.</p>
<p>The minimal amount of information required is the TAC data for one or more ROI, including the start and stop times of each frame, the time units and the activity units. This information may be in 1 or more files depending on the format and software that created it.</p>
<p>For example, PMOD’s <code>.tac</code> files contain all of the information, but the TAC .voistat files do not contain start and stop times, but this information could be specified using a <code>.acqtimes</code> file. Support is also available for DFT format, which contains both TAC and volume data.</p>
<p>We processed the PIB PET and T1 MRI data with the <strong>PMOD PNEURO</strong> software suite to produce a <code>.tac</code> file with TACs for all ROIs in the Hammer’s atlas. The <code>.tac</code> file can be loaded with <code><a href="../reference/load_tac.html">load_tac()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filename is a character string of the file's path on your computer.</span></span>
<span><span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AD06.tac"</span>, package<span class="op">=</span><span class="st">"tacmagic"</span><span class="op">)</span></span>
<span><span class="co"># Note: This file can also serve as a template if the TAC data is in some other </span></span>
<span><span class="co"># format that is not yet supported.</span></span>
<span></span>
<span><span class="va">AD06_tac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tac.html">load_tac</a></span><span class="op">(</span><span class="va">filename</span>, format<span class="op">=</span><span class="st">"PMOD"</span><span class="op">)</span></span></code></pre></div>
<p>A TAC object is a data frame with extra attributes including time and activity units. A summary can be printed with the generic <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">AD06_tac</span><span class="op">)</span> </span>
<span><span class="co">#&gt; tac object</span></span>
<span><span class="co">#&gt;  Activity unit:           kBq/cc </span></span>
<span><span class="co">#&gt;  Time unit:               seconds </span></span>
<span><span class="co">#&gt;  Number of ROIs:          172 </span></span>
<span><span class="co">#&gt;  Number of frames:        34 </span></span>
<span><span class="co">#&gt;  Time span:               0 - 5400 seconds </span></span>
<span><span class="co">#&gt;  Unique frame durations:  15 30 60 180 300 600 seconds</span></span>
<span></span>
<span><span class="va">AD06_tac</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="co"># the first 5 frames of the first 3 ROIs</span></span>
<span><span class="co">#&gt;   start end FL_mid_fr_G_l FL_mid_fr_G_r FL_precen_G_l</span></span>
<span><span class="co">#&gt; 1     0  15    0.05156934     0.0830544   -0.05035268</span></span>
<span><span class="co">#&gt; 2    15  30    5.76280770     5.9782509    6.15967912</span></span>
<span><span class="co">#&gt; 3    30  45   16.07137663    16.3756559   16.69802808</span></span>
<span><span class="co">#&gt; 4    45  60   19.11766922    19.4707593   18.52006408</span></span>
<span><span class="co">#&gt; 5    60  90   19.77191392    20.3383362   19.55189423</span></span></code></pre></div>
<p>PMOD’s suite also produces <code>.voistat</code> and <code>.acqtimes</code> formats, than can be used to produce the same data if you do not have <code>.tac</code> files:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filename_acq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AD06.acqtimes"</span>, package<span class="op">=</span><span class="st">"tacmagic"</span><span class="op">)</span></span>
<span><span class="va">filename_voistat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AD06_TAC.voistat"</span>, package<span class="op">=</span><span class="st">"tacmagic"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tac2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tac.html">load_tac</a></span><span class="op">(</span><span class="va">filename_voistat</span>, format<span class="op">=</span><span class="st">"voistat"</span>, acqtimes<span class="op">=</span><span class="va">filename_acq</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">AD06_tac</span>, <span class="va">tac2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>We also used Turku’s <strong>magia</strong> pipeline to process the same data. It can be loaded similarly, though with units explicitly entered because the information is not encoded in the .mat file:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_magia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AD06_tac_magia.mat"</span>, package<span class="op">=</span><span class="st">"tacmagic"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AD06_tac_magia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tac.html">load_tac</a></span><span class="op">(</span><span class="va">f_magia</span>, format<span class="op">=</span><span class="st">"magia"</span>, </span>
<span>                           time_unit<span class="op">=</span><span class="st">"seconds"</span>, activity_unit<span class="op">=</span><span class="st">"kBq/cc"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AD06_tac_magia</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;   start end        CGA         CGP          LOC</span></span>
<span><span class="co">#&gt; 1     0  15  0.2070033  0.04986614 -0.001164075</span></span>
<span><span class="co">#&gt; 2    15  30  7.8729520  7.12711797  6.058719929</span></span>
<span><span class="co">#&gt; 3    30  45 16.6898445 17.37585231 18.097222061</span></span>
<span><span class="co">#&gt; 4    45  60 17.7306580 19.33122997 21.146157237</span></span>
<span><span class="co">#&gt; 5    60  90 18.9857118 19.57800502 22.009607171</span></span></code></pre></div>
<div class="section level4">
<h4 id="manually-created-tac-objects">Manually-created TAC objects<a class="anchor" aria-label="anchor" href="#manually-created-tac-objects"></a>
</h4>
<p>For other data sources, <strong>tacmagic</strong> TAC objects can be created from data.frame objects with <code><a href="../reference/as.tac.html">as.tac()</a></code>. The time and activity units must be specified as arguments if not already set as attributes in the data.frame. The columns of the data.frame are the regional TACs, with the column names the names of the ROIs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">manual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, end<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, ROI1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10.1</span><span class="op">:</span><span class="fl">14.2</span><span class="op">)</span>, ROI2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">manual_tac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.tac.html">as.tac</a></span><span class="op">(</span><span class="va">manual</span>, time_unit<span class="op">=</span><span class="st">"minutes"</span>, activity_unit<span class="op">=</span><span class="st">"kBq/cc"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">manual_tac</span><span class="op">)</span></span>
<span><span class="co">#&gt; tac object</span></span>
<span><span class="co">#&gt;  Activity unit:           kBq/cc </span></span>
<span><span class="co">#&gt;  Time unit:               minutes </span></span>
<span><span class="co">#&gt;  Number of ROIs:          2 </span></span>
<span><span class="co">#&gt;  Number of frames:        5 </span></span>
<span><span class="co">#&gt;  Time span:               0 - 6 minutes </span></span>
<span><span class="co">#&gt;  Unique frame durations:  2 minutes</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="radioactivity-unit-conversion">Radioactivity unit conversion<a class="anchor" aria-label="anchor" href="#radioactivity-unit-conversion"></a>
</h3>
<p>Most modern PET tools use kBq/cc as the standard activity units required by the software (e.g. TPCCLIB, PMOD). Most often data will be in this format and not require conversion. However, conversion of TAC objects to these units, or to other radioactivity units for that matter, is possible with <code><a href="../reference/change_units.html">change_units()</a></code>. This is a generic function that works on <code>tac</code> objects as well as <code>numeric</code> objects. For <code>numeric</code> objects, both “to” and “from” units need to be specified. The function works regardless of whether the units are per volume (i.e. kBq is treated the same was as kBq/cc or kBq/mL).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/change_units.html">change_units</a></span><span class="op">(</span><span class="fl">5</span>, to_unit <span class="op">=</span> <span class="st">"kBq"</span>, from_unit <span class="op">=</span> <span class="st">"nCi"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.185</span></span>
<span><span class="fu"><a href="../reference/change_units.html">change_units</a></span><span class="op">(</span><span class="fl">0.5</span>, to_unit <span class="op">=</span> <span class="st">"nCi/cc"</span>, from_unit <span class="op">=</span> <span class="st">"kBq/cc"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 13.51351</span></span></code></pre></div>
<p>With <code>tac</code> objects, as the activity units are stored in the object, they should not be provided to <code><a href="../reference/change_units.html">change_units()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AD06_nCi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/change_units.html">change_units</a></span><span class="op">(</span><span class="va">AD06_tac</span>, to_unit <span class="op">=</span> <span class="st">"nCi/cc"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">AD06_nCi</span><span class="op">)</span></span>
<span><span class="co">#&gt; tac object</span></span>
<span><span class="co">#&gt;  Activity unit:           nCi/cc </span></span>
<span><span class="co">#&gt;  Time unit:               seconds </span></span>
<span><span class="co">#&gt;  Number of ROIs:          172 </span></span>
<span><span class="co">#&gt;  Number of frames:        34 </span></span>
<span><span class="co">#&gt;  Time span:               0 - 5400 seconds </span></span>
<span><span class="co">#&gt;  Unique frame durations:  15 30 60 180 300 600 seconds</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="roi-merging">ROI merging<a class="anchor" aria-label="anchor" href="#roi-merging"></a>
</h3>
<p>Often it is desirable to combine TAC ROIs into larger ROIs. For example, if the PET analysis pipeline created TACs for each atlas ROI, your analysis may call for merging these atomic ROIs into larger regions, such as merging all of the atlas ROIs that make up the frontal lobe into a single frontal lobe ROI.</p>
<p>If this is done, the means should be weighted for the relative volumes of the atomic ROIs. If volume information is available, <code><a href="../reference/tac_roi.html">tac_roi()</a></code> provides this functionality.</p>
<p>In PMOD’s software, volume information is available in <code>.voistat</code> files. Units do not matter because it is the relative volume information that is needed.</p>
<p>In addition to TAC and volume information, we must specify which atomic ROIs make up the merged ROI. This is done by providing a named list, where the names are the merged ROIs and the list items are themselves lists of the atomic ROIs that make up each merged ROI. For the Hammer’s atlas, and as an example, typical data is provided in <code><a href="../reference/roi_ham_stand.html">roi_ham_stand()</a></code>, <code><a href="../reference/roi_ham_full.html">roi_ham_full()</a></code>, or <code><a href="../reference/roi_ham_pib.html">roi_ham_pib()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AD06_volume</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_vol.html">load_vol</a></span><span class="op">(</span><span class="va">filename_voistat</span>, format<span class="op">=</span><span class="st">"voistat"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/roi_ham_pib.html">roi_ham_pib</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="co"># The first 2 definitions of merged ROIs, as an example.</span></span>
<span><span class="co">#&gt; $leftfrontal</span></span>
<span><span class="co">#&gt;  [1] "FL_mid_fr_G_l"       "FL_precen_G_l"       "FL_strai_G_l"       </span></span>
<span><span class="co">#&gt;  [4] "FL_OFC_AOG_l"        "FL_inf_fr_G_l"       "FL_sup_fr_G_l"      </span></span>
<span><span class="co">#&gt;  [7] "FL_OFC_MOG_l"        "FL_OFC_LOG_l"        "FL_OFC_POG_l"       </span></span>
<span><span class="co">#&gt; [10] "Subgen_antCing_l"    "Subcall_area_l"      "Presubgen_antCing_l"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rightfrontal</span></span>
<span><span class="co">#&gt;  [1] "FL_mid_fr_G_r"       "FL_precen_G_r"       "FL_strai_G_r"       </span></span>
<span><span class="co">#&gt;  [4] "FL_OFC_AOG_r"        "FL_inf_fr_G_r"       "FL_sup_fr_G_r"      </span></span>
<span><span class="co">#&gt;  [7] "FL_OFC_MOG_r"        "FL_OFC_LOG_r"        "FL_OFC_POG_r"       </span></span>
<span><span class="co">#&gt; [10] "Subgen_antCing_r"    "Subcall_area_r"      "Presubgen_antCing_r"</span></span>
<span></span>
<span><span class="va">AD06</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tac_roi.html">tac_roi</a></span><span class="op">(</span>tac<span class="op">=</span><span class="va">AD06_tac</span>,           <span class="co"># The TAC file we loaded above.</span></span>
<span>                volumes<span class="op">=</span><span class="va">AD06_volume</span>,    <span class="co"># Volume information loaded.</span></span>
<span>                ROI_def<span class="op">=</span><span class="fu"><a href="../reference/roi_ham_pib.html">roi_ham_pib</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co"># ROI definitions for the Hammers atlas</span></span>
<span>                merge<span class="op">=</span><span class="cn">F</span>,                <span class="co"># T to also return atomic ROIs</span></span>
<span>                PVC<span class="op">=</span><span class="cn">F</span>                   <span class="co"># to use _C ROIs (PMOD convention)            </span></span>
<span>                <span class="op">)</span></span>
<span></span>
<span><span class="va">AD06</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;   start end leftfrontal rightfrontal lefttemporal</span></span>
<span><span class="co">#&gt; 1     0  15  0.02912641   0.05734614    0.0612965</span></span>
<span><span class="co">#&gt; 2    15  30  6.12655470   6.23215512    6.3573101</span></span>
<span><span class="co">#&gt; 3    30  45 16.06737144  16.00035525   15.4122525</span></span>
<span><span class="co">#&gt; 4    45  60 18.31769407  18.45778499   17.3612789</span></span>
<span><span class="co">#&gt; 5    60  90 19.24138550  19.18263937   17.9358282</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h3>
<p>Basic TAC plotting can be done by calling <code>plot</code>, which accepts two TAC objects, e.g. from 2 participants or group means. The ROIs to plot are specified as a vector of ROI names as they appear in the TAC object. As the TAC object contains time unit information, the plot can convert to desired units, which can be specified with the <code>time</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">AD06</span>,                                                    <span class="co"># TAC data</span></span>
<span>     ROIs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"frontal"</span>, <span class="st">"temporal"</span>, <span class="st">"parietal"</span>, <span class="st">"cerebellum"</span><span class="op">)</span>, <span class="co"># ROIs to plot</span></span>
<span>     time<span class="op">=</span><span class="st">"minutes"</span>,                   <span class="co"># Convert x axis from seconds to minutes</span></span>
<span>     title<span class="op">=</span><span class="st">"PIB time activity curves for AD06"</span>        <span class="co"># A title for the plot</span></span>
<span>     <span class="op">)</span></span></code></pre></div>
<p><img src="walkthrough_files/figure-html/unnamed-chunk-9-1.png" width="624" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="model-calculation">Model calculation<a class="anchor" aria-label="anchor" href="#model-calculation"></a>
</h2>
<div class="section level3">
<h3 id="standardized-uptake-value-suv">Standardized uptake value (SUV)<a class="anchor" aria-label="anchor" href="#standardized-uptake-value-suv"></a>
</h3>
<p>As the activity in the TAC is impacted by the dose of the radiotracer administered and the participant’s body weight, a value adjusted for these factors is sometimes used, the <a href="http://www.turkupetcentre.net/petanalysis/model_suv.html" class="external-link">SUV</a>:</p>
<p><span class="math display">\[SUV = \frac{Ct}{\frac{Dose}{Weight}}\]</span></p>
<p>Where activity is measured in <em>kBq/mL (kBq/cc)</em>, the dose is in <em>MBq</em>, and the weight is in <em>kg</em>, the radioactivity units cancel and the SUV units are g/mL.</p>
<p>With the <code><a href="../reference/tac_suv.html">tac_suv()</a></code> function, a <code>tac</code> object can be converted to SUV values with units <em>g/mL</em>, as demonstrated below (note the weight and dose are fabricated here for the demonstration).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AD06_suv_tac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tac_suv.html">tac_suv</a></span><span class="op">(</span><span class="va">AD06</span>, dose <span class="op">=</span> <span class="fl">8.5</span>, dose_unit <span class="op">=</span> <span class="st">"mCi"</span>, weight_kg <span class="op">=</span> <span class="fl">70</span><span class="op">)</span></span></code></pre></div>
<p>More often, an everage value over a certain time period, or a maximum value may be desired. This can be calculated with the <code><a href="../reference/suv.html">suv()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AD06_suv_calc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suv.html">suv</a></span><span class="op">(</span><span class="va">AD06</span>, SUV_def <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3000</span>, <span class="fl">3300</span>, <span class="fl">3600</span><span class="op">)</span>, dose <span class="op">=</span> <span class="fl">8.5</span>, dose_unit <span class="op">=</span> <span class="st">"mCi"</span>, weight_kg <span class="op">=</span> <span class="fl">70</span><span class="op">)</span></span>
<span><span class="va">AD06_suv_calc</span><span class="op">[</span><span class="st">"frontal"</span>,<span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1.713055</span></span>
<span><span class="va">AD06_suv_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suv.html">suv</a></span><span class="op">(</span><span class="va">AD06</span>, SUV_def <span class="op">=</span> <span class="st">"max"</span>, dose <span class="op">=</span> <span class="fl">8.5</span>, dose_unit <span class="op">=</span> <span class="st">"mCi"</span>, weight_kg <span class="op">=</span> <span class="fl">70</span><span class="op">)</span></span>
<span><span class="va">AD06_suv_max</span><span class="op">[</span><span class="st">"frontal"</span>,<span class="op">]</span></span>
<span><span class="co">#&gt; [1] 4.338809</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="suv-ratio-suvr">SUV ratio (SUVR)<a class="anchor" aria-label="anchor" href="#suv-ratio-suvr"></a>
</h3>
<p>The standardized uptake value ratio (<span class="math inline">\(SUVR\)</span>) is a simple quantification of PET activity that is commonly used from many tracers including PIB. It is the ratio of the tracer activity over a specified time period (<span class="math inline">\(Ct\)</span>) in a target ROI to a reference region. Using a ratio allows factors that are normally required to calculate an <span class="math inline">\(SUV\)</span> to cancel out, namely tracer dose and patient body weight, and therefore <span class="math inline">\(SUVR\)</span> can be calculated from TAC data alone, i.e. without the need to specify tracer dose or body weight:</p>
<p><span class="math display">\[SUVR = \frac{SUV_{TARGET}}{SUV_{REF}} = \frac{Ct_{TARGET}}{Ct_{REF}}\]</span></p>
<p>In the literature, SUVR is variably described and calculated using the mean of activity for the frames of the specified time period, or the area under the curve. For PIB, the mean/summed activity has been used, and the time windows have varied from starting at 40-50 minutes and ending at 60-90 minutes.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Lopresti, B. J., W. E. Klunk, C. A. Mathis, J. A. Hoge, S. K. Ziolko, X. Lu, C. C. Meltzer, et al. “Simplified Quantification of Pittsburgh Compound B Amyloid Imaging PET Studies: A Comparative Analysis.” J Nucl Med 46 (2005): 1959–72.&lt;/p&gt;"><sup>3</sup></a></p>
<p>The <code><a href="../reference/suvr.html">suvr()</a></code> function calculates SUVR for all regions in a TAC file based on the provided time information (as a vector of frame start times) and the specified reference region (a string). If the frames used are of different durations, the weighted mean is used.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AD06_SUVR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suvr.html">suvr</a></span><span class="op">(</span><span class="va">AD06</span>,                       <span class="co"># TAC data</span></span>
<span>                  SUVR_def<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3000</span>,<span class="fl">3300</span>,<span class="fl">3600</span><span class="op">)</span>, <span class="co"># = 50-70 minute window</span></span>
<span>                  ref<span class="op">=</span><span class="st">"cerebellum"</span>            <span class="co"># reference region in TAC data</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="va">AD06_SUVR</span></span>
<span><span class="co">#&gt;                    SUVR</span></span>
<span><span class="co">#&gt; leftfrontal    2.070909</span></span>
<span><span class="co">#&gt; rightfrontal   2.200107</span></span>
<span><span class="co">#&gt; lefttemporal   2.043683</span></span>
<span><span class="co">#&gt; righttemporal  2.176933</span></span>
<span><span class="co">#&gt; leftparietal   2.054232</span></span>
<span><span class="co">#&gt; rightparietal  2.169382</span></span>
<span><span class="co">#&gt; leftoccipital  1.659831</span></span>
<span><span class="co">#&gt; rightoccipital 1.827765</span></span>
<span><span class="co">#&gt; leftcingulate  2.348674</span></span>
<span><span class="co">#&gt; rightcingulate 2.396375</span></span>
<span><span class="co">#&gt; frontal        2.136009</span></span>
<span><span class="co">#&gt; temporal       2.110140</span></span>
<span><span class="co">#&gt; parietal       2.112264</span></span>
<span><span class="co">#&gt; occipital      1.744258</span></span>
<span><span class="co">#&gt; cingulate      2.371747</span></span>
<span><span class="co">#&gt; cerebellum     1.000000</span></span>
<span><span class="co">#&gt; totalcortical  2.073093</span></span>
<span><span class="co">#&gt; leftdeep       1.788912</span></span>
<span><span class="co">#&gt; rightdeep      1.755389</span></span>
<span><span class="co">#&gt; deep           1.772272</span></span>
<span><span class="co">#&gt; ventricles     0.902195</span></span>
<span><span class="co">#&gt; whitematter    2.035768</span></span>
<span><span class="co">#&gt; amyloidcomp    2.231989</span></span></code></pre></div>
<p>An alternative method, using the area under the curve with the mid-frame times as the x-axis is available with <code><a href="../reference/suvr_auc.html">suvr_auc()</a></code> and should provide very similar results.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AD06_altSUVR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suvr_auc.html">suvr_auc</a></span><span class="op">(</span><span class="va">AD06</span>, SUVR_def<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3000</span>,<span class="fl">3300</span>,<span class="fl">3600</span><span class="op">)</span>, ref<span class="op">=</span><span class="st">"cerebellum"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">AD06_SUVR</span>, <span class="va">AD06_altSUVR</span><span class="op">)</span> <span class="co"># Should be similar but not exact</span></span>
<span><span class="co">#&gt; [1] "Component \"SUVR\": Mean relative difference: 0.007765957"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dvr">DVR<a class="anchor" aria-label="anchor" href="#dvr"></a>
</h3>
<p>The Distribution Volume Ratio (DVR) is a method of quantifying tracer uptake that is used as an alternative to the SUVR in PIB studies, for example. Like SUVR, it can be calculated from TAC data without the need for arterial blood sampling, by making use of a reference region. In this case, it is called the <em>non-invasive</em> Logan plot method. It is calculated with a graphical analysis technique described by Logan et al.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Logan, J., Fowler, J. S., Volkow, N. D., Wang, G.-J., Ding, Y.-S., &amp;amp; Alexoff, D. L. (1996). Distribution Volume Ratios without Blood Sampling from Graphical Analysis of PET Data. Journal of Cerebral Blood Flow &amp;amp; Metabolism, 16(5), 834-840. &lt;a href="https://doi.org/10.1097/00004647-199609000-00008" class="external-link uri"&gt;https://doi.org/10.1097/00004647-199609000-00008&lt;/a&gt;&lt;/p&gt;'><sup>4</sup></a></p>
<p>In addition to the TAC data, depending on the tracer, a value for k2’ may need to be specified. For PIB, this has limited effect on the result, but can be specified, and a value of 0.2 has been recommended.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="http://www.turkupetcentre.net/petanalysis/analysis_11c-pib.html" class="external-link uri"&gt;http://www.turkupetcentre.net/petanalysis/analysis_11c-pib.html&lt;/a&gt;&lt;/p&gt;'><sup>5</sup></a></p>
<p>The non-invasive Logan plot works by finding the slope of the line of the following equation after time <span class="math inline">\(t*\)</span> where linearity has been reached:</p>
<p><span class="math display">\[\frac{\int_0^{T}C_{roi}(t)dt}{C_{roi}(t)} = DVR[\frac{\int_0^{T}C_{cer}(t)dt + C_{cer}(t) / k2`}{C_{roi}(T)}] + int  \]</span></p>
<div class="section level4">
<h4 id="find-t">Find t*<a class="anchor" aria-label="anchor" href="#find-t"></a>
</h4>
<p>The time, <span class="math inline">\(t*\)</span> (<code>t_star</code>), after which the relationship is linear can be found by testing the point after which the error is below a certain threshold (default is 10%). If <code>t_star=0</code>, then tacmagic can find the suitable value.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AD06_DVR_fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DVR_ref_Logan.html">DVR_ref_Logan</a></span><span class="op">(</span><span class="va">AD06</span>, </span>
<span>                             target<span class="op">=</span><span class="st">"frontal"</span>, <span class="co"># target ROI</span></span>
<span>                             ref<span class="op">=</span><span class="st">"cerebellum"</span>, <span class="co"># reference region</span></span>
<span>                             k2prime<span class="op">=</span><span class="fl">0.2</span>,      <span class="co"># suitable k2' for tracer</span></span>
<span>                             t_star<span class="op">=</span><span class="fl">0</span>,        <span class="co"># 0 to find, or can specify frame</span></span>
<span>                             <span class="op">)</span></span>
<span><span class="co">#&gt; t* is 23</span></span>
<span></span>
<span><span class="va">AD06_DVR_fr</span><span class="op">$</span><span class="va">DVR</span></span>
<span><span class="co">#&gt; [1] 1.780057</span></span></code></pre></div>
<p>To visually confirm that the model behaved as expected with linearity, there is a plotting function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">AD06_DVR_fr</span><span class="op">)</span></span></code></pre></div>
<p><img src="walkthrough_files/figure-html/unnamed-chunk-15-1.png" width="624" style="display: block; margin: auto;"></p>
<p>The right plot shows the Logan model, with the vertical line representing the identified <span class="math inline">\(t*\)</span>, and the linear model fitted to the points after that time. In this case, the line after <span class="math inline">\(t*\)</span> can be seen to fit well. The slope of that line is the DVR.</p>
<p>Similarly, DVR can be calculated for all ROIs, either by setting <code>t_star</code> manually or to 0 as before. If 0, a different value will be identified for each ROI.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AD06_DVR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DVR_all_ref_Logan.html">DVR_all_ref_Logan</a></span><span class="op">(</span><span class="va">AD06</span>, ref<span class="op">=</span><span class="st">"cerebellum"</span>, k2prime<span class="op">=</span><span class="fl">0.2</span>, t_star<span class="op">=</span><span class="fl">23</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trying leftfrontal</span></span>
<span><span class="co">#&gt; Trying rightfrontal</span></span>
<span><span class="co">#&gt; Trying lefttemporal</span></span>
<span><span class="co">#&gt; Trying righttemporal</span></span>
<span><span class="co">#&gt; Trying leftparietal</span></span>
<span><span class="co">#&gt; Trying rightparietal</span></span>
<span><span class="co">#&gt; Trying leftoccipital</span></span>
<span><span class="co">#&gt; Trying rightoccipital</span></span>
<span><span class="co">#&gt; Trying leftcingulate</span></span>
<span><span class="co">#&gt; Trying rightcingulate</span></span>
<span><span class="co">#&gt; Trying frontal</span></span>
<span><span class="co">#&gt; Trying temporal</span></span>
<span><span class="co">#&gt; Trying parietal</span></span>
<span><span class="co">#&gt; Trying occipital</span></span>
<span><span class="co">#&gt; Trying cingulate</span></span>
<span><span class="co">#&gt; Trying cerebellum</span></span>
<span><span class="co">#&gt; Trying totalcortical</span></span>
<span><span class="co">#&gt; Trying leftdeep</span></span>
<span><span class="co">#&gt; Trying rightdeep</span></span>
<span><span class="co">#&gt; Trying deep</span></span>
<span><span class="co">#&gt; Trying ventricles</span></span>
<span><span class="co">#&gt; Trying whitematter</span></span>
<span><span class="co">#&gt; Trying amyloidcomp</span></span>
<span></span>
<span><span class="va">AD06_DVR</span></span>
<span><span class="co">#&gt;                      DVR</span></span>
<span><span class="co">#&gt; leftfrontal    1.7351136</span></span>
<span><span class="co">#&gt; rightfrontal   1.8241000</span></span>
<span><span class="co">#&gt; lefttemporal   1.7023599</span></span>
<span><span class="co">#&gt; righttemporal  1.7978415</span></span>
<span><span class="co">#&gt; leftparietal   1.7148840</span></span>
<span><span class="co">#&gt; rightparietal  1.8014491</span></span>
<span><span class="co">#&gt; leftoccipital  1.4303466</span></span>
<span><span class="co">#&gt; rightoccipital 1.5521520</span></span>
<span><span class="co">#&gt; leftcingulate  1.9240049</span></span>
<span><span class="co">#&gt; rightcingulate 1.9542491</span></span>
<span><span class="co">#&gt; frontal        1.7800568</span></span>
<span><span class="co">#&gt; temporal       1.7500941</span></span>
<span><span class="co">#&gt; parietal       1.7585448</span></span>
<span><span class="co">#&gt; occipital      1.4915376</span></span>
<span><span class="co">#&gt; cingulate      1.9389554</span></span>
<span><span class="co">#&gt; cerebellum     1.0000000</span></span>
<span><span class="co">#&gt; totalcortical  1.7294061</span></span>
<span><span class="co">#&gt; leftdeep       1.5304215</span></span>
<span><span class="co">#&gt; rightdeep      1.5307336</span></span>
<span><span class="co">#&gt; deep           1.5305573</span></span>
<span><span class="co">#&gt; ventricles     0.7435322</span></span>
<span><span class="co">#&gt; whitematter    1.6615718</span></span>
<span><span class="co">#&gt; amyloidcomp    1.8487819</span></span></code></pre></div>
<p>For this data, the DVR calculation has been shown to produce equivalent results as an existing tool.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://gitlab.utu.fi/vesoik/tpcclib" class="external-link uri"&gt;https://gitlab.utu.fi/vesoik/tpcclib&lt;/a&gt;&lt;/p&gt;'><sup>6</sup></a></p>
<p>A wrapper function <code><a href="../reference/dvr.html">dvr()</a></code> is available to conveniently calculate DVR for a target ROI or all ROIs, and currently defaults to using the Logan reference method:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ADO6_frontal_DVR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dvr.html">dvr</a></span><span class="op">(</span><span class="va">AD06</span>, target<span class="op">=</span><span class="st">"frontal"</span>, ref<span class="op">=</span><span class="st">"cerebellum"</span>, k2prime<span class="op">=</span><span class="fl">0.2</span>, </span>
<span>                        t_star<span class="op">=</span><span class="fl">23</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="batch-analysis">Batch analysis<a class="anchor" aria-label="anchor" href="#batch-analysis"></a>
</h2>
<p>In most cases, a project will involve the analysis of multiple participants. The above workflow can be used to test and visualize an analysis, but a batch workflow will likely be preferred to analyze multiple participants.</p>
<p>All analyses can be run using 2 steps: a batch data loading step and a batch analysis step.</p>
<div class="section level3">
<h3 id="batch-loading">Batch loading<a class="anchor" aria-label="anchor" href="#batch-loading"></a>
</h3>
<p>Data loading is done by <code><a href="../reference/batch_load.html">batch_load()</a></code>. See <code><a href="../reference/batch_load.html">help(batch_load)</a></code> for the required arguments.</p>
<p>The first argument is a vector of participant IDs that corresponds to file names, e.g.:</p>
<p><code>participants &lt;- c("participant01", "participant02")</code> if the files are located e.g. <code>/mypath/participant01.tac</code> and <code>/mypath/participant01_TAC.voistat</code>. In this case, the function call might look like:</p>
<p><code>my_data &lt;- batch_load(participants, dir="/mypath/", tac_format="PMOD", roi_m=T, vol_file_suffix="_TAC.voistat", vol_format="voistat", ROI_def=roi_ham_stand(), merge=F)</code></p>
<p>The above would load the appropriate TAC and voistat files, perform the ROI merging specified by <code>ROI_def</code>, because <code>roi_m = TRUE</code>, and would return a list where each element represents a participants, e.g. the first participant would be <code>my_data$participant1</code>.</p>
<p>To calculate SUV in batch, the participants dose and weight must be specified when loading with <code><a href="../reference/batch_load.html">batch_load()</a></code>, as it is then added to the respective <code>tac</code> objects.</p>
</div>
<div class="section level3">
<h3 id="batch-analysis-1">Batch analysis<a class="anchor" aria-label="anchor" href="#batch-analysis-1"></a>
</h3>
<p>Once the TAC data is loaded, all analyses can be run using <code><a href="../reference/batch_tm.html">batch_tm()</a></code>. The output from <code><a href="../reference/batch_load.html">batch_load()</a></code> is the first argument for <code><a href="../reference/batch_tm.html">batch_tm()</a></code>. The models implemented in tacmagic can be specified using the <code>models</code> argument, e.g. <code>models = c("SUVR", "Logan")</code> to calculate both SUVR and Logan DVR. The relevant model parameters will also need to be specified, so see <code><a href="../reference/batch_tm.html">help(batch_tm)</a></code> for all possible arguments.</p>
</div>
<div class="section level3">
<h3 id="batch-example">Batch example<a class="anchor" aria-label="anchor" href="#batch-example"></a>
</h3>
<p>For the purpose of the vignette, the list of participants will be a list of the full TAC filenames (hence tac_file_suffix=““). In real-world data, the participants parameter can be a list of participant IDs that correspond to the actual filenames, i.e. the filename is made up of dir + participant + tac_file_suffix.</p>
<p>We will also choose not to use the roi_m option in batch_load(), which could be used to combine ROIs as outlined above.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">participants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AD06.tac"</span>, package<span class="op">=</span><span class="st">"tacmagic"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AD07.tac"</span>, package<span class="op">=</span><span class="st">"tacmagic"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AD08.tac"</span>, package<span class="op">=</span><span class="st">"tacmagic"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tacs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_load.html">batch_load</a></span><span class="op">(</span><span class="va">participants</span>, dir<span class="op">=</span><span class="st">""</span>, tac_file_suffix<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Since the PMOD TAC files used here have 2 copies of ROIs, with and without </span></span>
<span><span class="co"># PVC, we can use split_pvc to keep the PVC-corrected verions. If we had used </span></span>
<span><span class="co"># roi_m here to combine ROIs, we could have specified to use the PVC versions </span></span>
<span><span class="co"># in batch_load() with PVC = TRUE.</span></span>
<span><span class="va">tacs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tacs</span>, <span class="va">split_pvc</span>, PVC<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span> </span>
<span><span class="va">batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_tm.html">batch_tm</a></span><span class="op">(</span><span class="va">tacs</span>, models<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SUVR"</span>, <span class="st">"Logan"</span><span class="op">)</span>, ref<span class="op">=</span><span class="st">"Cerebellum_r_C"</span>,</span>
<span>                  SUVR_def<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3000</span>,<span class="fl">3300</span>,<span class="fl">3600</span><span class="op">)</span>, k2prime<span class="op">=</span><span class="fl">0.2</span>, t_star<span class="op">=</span><span class="fl">23</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="cut-off-calculations">Cut-off calculations<a class="anchor" aria-label="anchor" href="#cut-off-calculations"></a>
</h2>
<p>In the analysis of PIB/amyloid PET data, often researchers want to dichotomize patients into PIB+ vs. PIB-, i.e. to identify those with significant AD-related amyloid pathology (PIB+).</p>
<p>There are a number of approaches to this depending on the available data. We have implemented a method described by Aizenstein et al.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Aizenstein HJ, Nebes RD, Saxton JA, et al. 2008. Frequent amyloid deposition without significant cognitive impairment among the elderly. Arch Neurol 65: 1509-1517.&lt;/p&gt;"><sup>7</sup></a> which uses a group of participants with normal cognition to establish a cutoff value above which participants are unlikely to have minimal amyloid pathology.</p>
<p>The method identifies a group of participants out of the normal cognition group with higher-PIB outliers removed. An outlier is a participant with any ROI with a DVR higher than the upper inner fence, from a set of ROIs known to be associated with amyloid deposition. Such participants are removed from the group, and this process is done iteratively until no more outliers are removed. Then, cutoff values are determined from this new group for each ROI, set again as the upper inner fence. Then these cutoff values are applied to all participants, and a participant is deemed PIB+ if they have at least 1 ROI above its cutoff.</p>
<p>To demonstrate, a fake dataset of DVR values for 50 fake participants was generated and is available as <code>fake_DVR</code>. This would be equivalent to using <code><a href="../reference/batch_tm.html">batch_tm()</a></code> on a group of participants with the <code>"Logan"</code> model specified.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fake_DVR</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;    ROI1_DVR ROI2_DVR  ROI3_DVR  ROI4_DVR</span></span>
<span><span class="co">#&gt; p1 2.235058 3.026140 1.1420583 4.0557974</span></span>
<span><span class="co">#&gt; p2 1.677543 2.834710 1.2529424 3.3368371</span></span>
<span><span class="co">#&gt; p3 1.466090 2.856528 0.2837647 2.5383574</span></span>
<span><span class="co">#&gt; p4 1.046542 1.818056 1.2176133 2.5827267</span></span>
<span><span class="co">#&gt; p5 2.934105 1.971775 1.7611040 0.8371429</span></span></code></pre></div>
<p>To calculate the cutoff values using this iterative method, <code><a href="../reference/cutoff_aiz.html">cutoff_aiz()</a></code> takes 2 arguments: the DVR data, and the names of the variables of the ROI DVRs to use (and there must be at least 2 for this method).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cutoffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cutoff_aiz.html">cutoff_aiz</a></span><span class="op">(</span><span class="va">fake_DVR</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ROI1_DVR"</span>, <span class="st">"ROI2_DVR"</span>, <span class="st">"ROI3_DVR"</span>, <span class="st">"ROI4_DVR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Iteration: 1 Removed: 10</span></span>
<span><span class="co">#&gt; Iteration: 2 Removed: 1</span></span>
<span><span class="co">#&gt; Iteration: 3 Removed: 0</span></span>
<span></span>
<span><span class="va">cutoffs</span></span>
<span><span class="co">#&gt; ROI1_DVR ROI2_DVR ROI3_DVR ROI4_DVR </span></span>
<span><span class="co">#&gt; 1.370899 1.332725 1.330504 1.273470</span></span></code></pre></div>
<p>The final step is to apply the cutoffs to the full set of participants. We will use the same sample data:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">positivity_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pos_anyroi.html">pos_anyroi</a></span><span class="op">(</span><span class="va">fake_DVR</span>, <span class="va">cutoffs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">positivity_table</span></span>
<span><span class="co">#&gt;    p1    p2    p3    p4    p5    p6    p7    p8    p9   p10   p11   p12   p13 </span></span>
<span><span class="co">#&gt;  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE </span></span>
<span><span class="co">#&gt;   p14   p15   p16   p17   p18   p19   p20   p21   p22   p23   p24   p25   p26 </span></span>
<span><span class="co">#&gt; FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE </span></span>
<span><span class="co">#&gt;   p27   p28   p29   p30   p31   p32   p33   p34   p35   p36   p37   p38   p39 </span></span>
<span><span class="co">#&gt; FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE </span></span>
<span><span class="co">#&gt;   p40   p41   p42   p43   p44   p45   p46   p47   p48   p49   p50 </span></span>
<span><span class="co">#&gt; FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></span></code></pre></div>
<p>The algorithm identified 11 PIB+ participants. In the generation of the sample data, the DVRs from the first 10 participants were drawn from a normal distribution with mean 1.9, sd 0.6 and for the latter 40 participants, from mean 1.3, sd 0.3; thus this pattern is in line with what we would expect: all 10 of the first participants are PIB+, and just 1 of the latter 40 was (by chance).</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
